<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:aop="http://www.springframework.org/schema/aop"
	xmlns:ehcache="http://ehcache-spring-annotations.googlecode.com/svn/schema/ehcache-spring"
	xmlns:jms="http://www.springframework.org/schema/jms"
	xmlns:amq="http://activemq.apache.org/schema/core"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:jpa="http://www.springframework.org/schema/data/jpa"
	xmlns:tx="http://www.springframework.org/schema/tx"
	xsi:schemaLocation="
		http://www.springframework.org/schema/beans
		http://www.springframework.org/schema/beans/spring-beans.xsd
		http://www.springframework.org/schema/aop
		http://www.springframework.org/schema/aop/spring-aop.xsd
		http://ehcache-spring-annotations.googlecode.com/svn/schema/ehcache-spring
		http://ehcache-spring-annotations.googlecode.com/svn/schema/ehcache-spring/ehcache-spring-1.0.xsd
		http://www.springframework.org/schema/jms
		http://www.springframework.org/schema/jms/spring-jms.xsd
		http://activemq.apache.org/schema/core
		http://activemq.apache.org/schema/core/activemq-core-5.8.0.xsd
		http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd
        http://www.springframework.org/schema/data/jpa
        http://www.springframework.org/schema/data/jpa/spring-jpa.xsd
        http://www.springframework.org/schema/tx
		http://www.springframework.org/schema/tx/spring-tx.xsd">

	<import resource="super-service-interceptors.xml"/>

	<jpa:repositories base-package="com.vidyo.superapp, com.vidyo.db.repository"/>
	<context:component-scan base-package="com.vidyo.superservice.rest.controllers,
		com.vidyo.superapp,
		com.vidyo.service,
		com.vidyo.bo,
		com.vidyo.db,
		com.vidyo.common.config" >
        <context:exclude-filter expression="com.vidyo.service.diagnostics.DiagnosticsService" type="regex"/>
        <context:exclude-filter expression="com.vidyo.service.installation.InstallationServiceImpl" type="regex"/>
    </context:component-scan>
	<tx:annotation-driven/>
	<context:annotation-config/>

	<bean id="applicationContextProvder" class="com.vidyo.framework.context.ApplicationContextProvider"/>
	<bean class="com.vidyo.framework.configuration.LdapAppConfiguration"/>
	<bean class="org.springframework.beans.factory.config.MethodInvokingFactoryBean">
		<property name="staticMethod" value="com.vidyo.framework.security.htmlcleaner.AntiSamyHtmlCleaner.setResource"/>
		<property name="arguments">
			<ref bean="policyResource"/>
		</property>
	</bean>

	<bean id="policyResource" class="org.springframework.core.io.ClassPathResource">
		<constructor-arg value="antisamy-ebay-1.5.3.xml"/>
	</bean>

	<amq:queue id="statusNotifyMQqueue" physicalName="statusNotify.queue"/>
	<amq:queue id="emailMessageMQqueue" physicalName="emailMessage.queue"/>

	<!-- MQ connection factory -->
	<bean id="activeMQConnectionFactory" class="org.apache.activemq.spring.ActiveMQConnectionFactory">
		<property name="brokerURL" value="tcp://localhost:61616"/>
		<property name="useAsyncSend" value="true"/>
		<property name="trustedPackages">
	        <list>
	            <value>com.vidyo.bo</value>
	            <value>org.springframework.mail</value>
	            <value>java.lang</value>	            
	        </list>
        </property>
	</bean>

	<bean id="jmsTemplate" class="org.springframework.jms.core.JmsTemplate">
		<property name="connectionFactory" ref="activeMQConnectionFactory"/>
	</bean>

	<bean id="jmsProducerTemplate" class="org.springframework.jms.core.JmsTemplate">
		<property name="connectionFactory" ref="activeMQConnectionFactory"/>
		<property name="pubSubDomain" value="true"/>
	</bean>

	<bean id="statusNotificationService"
		class="com.vidyo.service.statusnotify.StatusNotificationServiceImpl">
		<property name="conferenceService" ref="conferenceService" />
		<property name="statusNotificationDao" ref="statusNotificationDao" />
		<property name="systemService" ref="systemService" />
		<property name="emailService" ref="emailService" />
		<property name="licensingService" ref="licensingService" />
		<property name="tenantService" ref="tenantService" />
		<property name="jmsTemplate" ref="jmsTemplate" />
		<property name="statusNotifyMQqueue" ref="statusNotifyMQqueue" />
	</bean>

	<bean id="statusNotificationDao" class="com.vidyo.db.statusnotify.StatusNotificationDaoJdbcImpl">
		<property name="jdbcTemplate" ref="jdbcTemplate" />
	</bean>

	<!-- Configurer that replaces ${...} placeholders with values from a properties file -->
	<!-- (in this case, JDBC-related settings for the dataSoource definition below) -->
	<bean id="propertyConfigurer" class="com.vidyo.framework.propertyconfig.OpenPropertyPlaceholderConfigurer">
		<property name="location" value="file:/usr/local/tomcat/repo/vidyoportal/portal.properties" />
	</bean>

	<!-- Message source for this context, loaded from localized "messages_xx" files -->
	<bean id="messageSource" class="org.springframework.context.support.ReloadableResourceBundleMessageSource">
		<property name="basename" value="classpath:messages"/>
		<property name="defaultEncoding" value="UTF-8"/>
	</bean>

	<bean id="superServiceCacheManager" class="org.springframework.cache.ehcache.EhCacheManagerFactoryBean">
		<property name="configLocation" value="/WEB-INF/ehcache-super-service.xml"/>
		<property name="shared" value="true"/>
	</bean>

	<ehcache:annotation-driven cache-manager="superServiceCacheManager" />

	<bean id="HashCodeCacheKeyGenerator" class="com.googlecode.ehcache.annotations.key.HashCodeCacheKeyGenerator"/>
<bean id="StringCacheKeyGenerator" class="com.googlecode.ehcache.annotations.key.StringCacheKeyGenerator"/>
	<bean id="licenseDataCacheBackend" class="org.springframework.cache.ehcache.EhCacheFactoryBean">
		<property name="cacheManager" ref="superServiceCacheManager"/>
		<property name="cacheName" value="LicenseData"/>
	</bean>

	<bean id="ipcConfigurationService" class="com.vidyo.service.interportal.IpcConfigurationServiceImpl">
		<property name="interPortalConferenceDao" ref="interPortalConferenceDao" />
	</bean>

	<bean id="interPortalConferenceService" class="com.vidyo.service.interportal.InterPortalConferenceServiceImpl">
		<property name="ipcConfigurationService" ref="ipcConfigurationService" />
		<property name="systemService" ref="systemService"/>
		<property name="ipcDomainService" ref="ipcDomainService"/>
	</bean>

	<bean id="interPortalConferenceDao" class="com.vidyo.db.InterPortalConferenceDaoJdbcImpl">
		<property name="jdbcTemplate" ref="jdbcTemplate"/>
	</bean>

	<bean id="ipcDomainService" class="com.vidyo.service.IpcDomainServiceImpl">
		<property name="ipcDomainDao" ref="ipcDomainDao"/>
	</bean>

	<bean id="ipcDomainDao" class="com.vidyo.db.ipcdomain.IpcDomainDaoJdbcImpl">
		<property name="jdbcTemplate" ref="jdbcTemplate"/>
	</bean>

	<!-- DataSource -->
	<bean id="dataSource" class="org.springframework.jndi.JndiObjectFactoryBean">
		<property name="jndiName" value="java:comp/env/jdbc/portal2" />
		<property name="resourceRef" value="true"/>
	</bean>

	<bean id="systemProperties" class="com.vidyo.framework.system.SystemPropertyInitializing">
		<property name="systemProperties">
			<map>
				<entry key="org.apache.coyote.USE_CUSTOM_STATUS_MSG_IN_HEADER" value="true"/>
			</map>
		</property>
	</bean>

	<bean id="jdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
		<property name="dataSource" ref="dataSource"/>
	</bean>

	<bean id="namedParamJdbcTemplate" class="org.springframework.jdbc.core.namedparam.NamedParameterJdbcTemplate">
		<constructor-arg name="dataSource" ref="dataSource"/>
	</bean>

	<!-- EMail sender -->
    <bean id="emailService" class="com.vidyo.service.email.EmailServiceImpl">
        <property name="systemDao" ref="systemDao"/>
        <property name="jmsTemplate" ref="jmsTemplate"/>
        <property name="emailMessageMQqueue" ref="emailMessageMQqueue"/>
    </bean>


	<!-- Login service -->
	<bean id="loginDao" class="com.vidyo.db.LoginDaoJdbcImpl">
		<property name="jdbcTemplate" ref="jdbcTemplate"/>
	</bean>

	<bean id="loginService" class="com.vidyo.service.LoginServiceImpl">
		<property name="dao" ref="loginDao"/>
		<property name="memberDao" ref="memberDao" />
		<property name="emailService" ref="emailService"/>
		<property name="system" ref="systemService"/>
		<property name="ms" ref="messageSource" />
	</bean>


	<!-- User service -->
	<bean id="userDao" class="com.vidyo.db.UserDaoJdbcImpl">
		<property name="jdbcTemplate" ref="jdbcTemplate"/>
		<property name="namedParamJdbcTemplate" ref="namedParamJdbcTemplate"/>
	</bean>

	<bean id="availableDeviceDao" class="com.vidyo.db.AvailableDeviceDaoJdbcImpl">
		<property name="jdbcTemplate" ref="jdbcTemplate"/>
	</bean>

	<bean id="userService" class="com.vidyo.service.UserServiceImpl">
		<property name="dao" ref="userDao"/>
		<property name="system" ref="systemDao"/>
		<property name="conference" ref="conferenceService"/>
		<property name="tenantService" ref="tenantService"/>
		<property name="emailService" ref="emailService"/>
		<property name="ms" ref="messageSource"/>
		<property name="endpointService" ref="endpointService" />
		<property name="bindEndpointService" ref="bindEndpointService"/>
		<property name="userPortalPath" value="/flex.html"/>
		<property name="memberDao" ref="memberDao"/>
		<property name="statusNotificationService" ref="statusNotificationService" />
		<property name="guestService" ref="guestService"/>
	</bean>

	<!-- Member service -->
	<bean id="memberDao" class="com.vidyo.db.MemberDaoJdbcImpl">
		<property name="jdbcTemplate" ref="jdbcTemplate"/>
		<property name="namedParamJdbcTemplate" ref="namedParamJdbcTemplate"/>
	</bean>

	<bean id="memberService" class="com.vidyo.service.MemberServiceImpl">
		<property name="conference" ref="conferenceService"/>
		<property name="dao" ref="memberDao"/>
		<property name="room" ref="roomService"/>
		<property name="tenantService" ref="tenantService"/>
		<property name="user" ref="userService"/>
		<property name="groupService" ref="groupService" />
		<property name="systemService" ref="systemService" />
		<property name="thumbNailLocation" value="${upload.thumbnail.dir}" />
	</bean>


	<!-- Room service -->
	<bean id="roomDao" class="com.vidyo.db.RoomDaoJdbcImpl">
		<property name="jdbcTemplate" ref="jdbcTemplate"/>
		<property name="namedParamJdbcTemplate" ref="namedParamJdbcTemplate"/>
	</bean>

	<bean id="roomService" class="com.vidyo.service.RoomServiceImpl">
		<property name="dao" ref="roomDao"/>
		<property name="tenantService" ref="tenantService"/>
		<property name="generator" ref="roomPropertiesGenerator" />
		<property name="systemService" ref="systemService1" />
        <property name="systemServiceConfig" ref="systemService" />
		<property name="utilService" ref="utilService"/>
		<property name="memberService" ref="memberService1"/>
	</bean>


	<!-- Group service -->
	<bean id="groupDao" class="com.vidyo.db.GroupDaoJdbcImpl">
		<property name="jdbcTemplate" ref="jdbcTemplate"/>
		<property name="namedParamJdbcTemplate" ref="namedParamJdbcTemplate"/>
	</bean>

	<bean id="groupService" class="com.vidyo.service.GroupServiceImpl">
		<property name="dao" ref="groupDao"/>
		<property name="room" ref="roomService"/>
		<property name="tenantLdapAttributesMappingDao" ref="tenantLdapAttributesDao" />
		<property name="tenantIdpAttributesMappingDao" ref="tenantIdpAttributesDao" />
		<property name="systemService" ref="systemService" />
	</bean>


	<!-- Router service -->
	<bean id="routerDao" class="com.vidyo.db.RouterDaoJdbcImpl">
		<property name="jdbcTemplate" ref="jdbcTemplate"/>
	</bean>

	<bean id="routerService" class="com.vidyo.service.RouterServiceImpl">
		<property name="dao" ref="routerDao"/>
	</bean>


	<!-- Service service -->
	<bean id="serviceDao" class="com.vidyo.db.ServiceDaoJdbcImpl">
		<property name="jdbcTemplate" ref="jdbcTemplate"/>
	</bean>

	<bean id="serviceService" class="com.vidyo.service.ServiceServiceImpl">
		<property name="dao" ref="serviceDao"/>
		<property name="router" ref="routerService"/>
		<property name="cloudMarshaller" ref="cloudJaxb2Marshaller" />
		<property name="vmMarshaller" ref="vmJaxb2Marshaller" />
		<property name="vrMarshaller" ref="vrJaxb2Marshaller" />
		<property name="tenantLdapAttributesMappingDao" ref="tenantLdapAttributesDao" />
		<property name="tenantIdpAttributesMappingDao" ref="tenantIdpAttributesDao" />
		<property name="systemService" ref="systemService" />
        <property name="useNewGatewayServiceInterface" value="${useNewGatewayServiceInterface}"/>
	</bean>

	<!-- Network service -->
	<bean id="networkService" class="com.vidyo.service.NetworkServiceImpl"/>

	<!-- Licensing service -->
	<bean id="licensingService" class="com.vidyo.service.LicensingServiceImpl">
		<property name="member" ref="memberService"/>
		<property name="system" ref="systemService"/>
		<property name="tenant" ref="tenantService"/>
		<property name="licenseDao" ref="licenseDao"/>
	</bean>

	<!-- Endpoint Upload service -->
	<bean id="endpointUploadDao" class="com.vidyo.db.EndpointUploadDaoJdbcImpl">
		<property name="jdbcTemplate" ref="jdbcTemplate"/>
		<property name="namedParamJdbcTemplate" ref="namedParamJdbcTemplate"/>
	</bean>

	<bean id="endpointUploadService" class="com.vidyo.service.EndpointUploadServiceImpl">
		<property name="dao" ref="endpointUploadDao"/>
	</bean>


	<!-- Conference service -->
	<bean id="conferenceDao" class="com.vidyo.db.ConferenceDaoJdbcImpl">
		<property name="jdbcTemplate" ref="jdbcTemplate"/>
		<property name="namedParamJdbcTemplate" ref="namedParamJdbcTemplate"/>
	</bean>

	<bean id="conferenceService" class="com.vidyo.service.ConferenceServiceImpl">
		<property name="dao" ref="conferenceDao"/>
		<property name="room" ref="roomService"/>
		<property name="member" ref="memberService"/>
		<property name="group" ref="groupService"/>
		<property name="system" ref="systemService"/>
		<property name="user" ref="userService"/>
		<property name="tenant" ref="tenantService"/>
		<property name="licensingService" ref="licensingService"/>
		<property name="endpointService" ref="endpointService" />
		<property name="federationDao" ref="federationDao"/>
		<property name="cdrCollectionService" ref="cdrCollectionService" />
		<property name="bindEndpointService" ref="bindEndpointService"/>
		<property name="statusNotificationService" ref="statusNotificationService"/>
		<property name="transactionService" ref="transactionService"/>
		<property name="guestService" ref="guestService"/>
        <property name="gatewayVcapClient" ref="gatewayVcapClient"/>
        <property name="servicesService" ref="serviceService"/>
        <property name="lectureModeDao" ref="lectureModeDao" />
	</bean>

    <bean id="gatewayVcapClient" class="com.vidyo.rest.clients.gateway.GatewayVcapClient">
        <property name="servicesService" ref="serviceService"/>
    </bean>

    <bean id="restTemplate" class="org.springframework.web.client.RestTemplate">
        <constructor-arg>
            <bean class="org.springframework.http.client.SimpleClientHttpRequestFactory">
                <property name="connectTimeout" value="${restClientConnectionTimeout}" />
                <property name="readTimeout" value="${restClientReadTimeout}" />
            </bean>
        </constructor-arg>
    </bean>

	<bean id="guestService" class="com.vidyo.service.guest.GuestServiceImpl">
		<property name="guestDao" ref="guestDao"/>
	</bean>

	<bean id="guestDao" class="com.vidyo.db.guest.GuestDaoJdbcImpl">
		<property name="dataSource" ref="dataSource"/>
	</bean>

	<bean id="utilService" class="com.vidyo.service.utils.UtilServiceImpl">
		<property name="conferenceService" ref="conferenceService"/>
		<property name="memberService" ref="memberService"/>
		<property name="userService" ref="userService"/>
	</bean>


	<bean id="federationDao" class="com.vidyo.db.FederationDaoJdbcImpl">
		<property name="jdbcTemplate" ref="jdbcTemplate"/>
	</bean>

	<bean id="federationConferenceService" class="com.vidyo.service.FederationConferenceServiceImpl">
		<property name="dao" ref="conferenceDao"/>
		<property name="room" ref="roomService"/>
		<property name="member" ref="memberService"/>
		<property name="group" ref="groupService"/>
		<property name="system" ref="systemService"/>
		<property name="user" ref="userService"/>
		<property name="tenant" ref="tenantService"/>
		<property name="licensingService" ref="licensingService"/>
		<property name="endpointService" ref="endpointService" />
		<property name="federationDao" ref="federationDao"/>
		<property name="cdrCollectionService" ref="cdrCollectionService" />
		<property name="bindEndpointService" ref="bindEndpointService"/>
		<property name="statusNotificationService" ref="statusNotificationService"/>
		<property name="interPortalConferenceService" ref="interPortalConferenceService"/>
		<property name="transactionService" ref="transactionService"/>
		<property name="guestService" ref="guestService"/>
        <property name="gatewayVcapClient" ref="gatewayVcapClient"/>
        <property name="servicesService" ref="serviceService"/>
        <property name="lectureModeDao" ref="lectureModeDao" />
	</bean>

	<!-- System service -->
	<bean id="connectionManagerParams" class="org.apache.commons.httpclient.params.HttpConnectionManagerParams">
		<property name="maxTotalConnections" value="100"/>
		<property name="defaultMaxConnectionsPerHost" value="11"/>
		<property name="connectionTimeout" value="20000" />
		<!-- <property name="staleCheckingEnabled" value="true"/> -->
	</bean>

	<bean id="connectionManager" class="org.apache.commons.httpclient.MultiThreadedHttpConnectionManager">
		<property name="params" ref="connectionManagerParams"/>
	</bean>

	<bean id="systemDao" class="com.vidyo.db.SystemDaoJdbcImpl">
		<property name="jdbcTemplate" ref="jdbcTemplate"/>
		<property name="namedParamJdbcTemplate" ref="namedParamJdbcTemplate"/>
	</bean>

	<bean id="systemService" class="com.vidyo.service.SystemServiceImpl">
		<property name="dao" ref="systemDao"/>
		<property name="dbBackupPath" value="${dbbackup.path}"/>
		<property name="license" ref="licensingService"/>
		<property name="member" ref="memberService"/>
		<property name="ms" ref="messageSource" />
		<property name="tenantService" ref="tenantService"/>
		<property name="connectionManager" ref="connectionManager"/>
		<property name="propertyPlaceholderConfigurer" ref="propertyConfigurer" />
		<property name="jdbcURL" value="${jdbc.url}" />
        <property name="attributesMapper" ref="ldapUserToMemberAttributesMapper"/>
        <property name="samlAuthenticationService" ref="samlAuthenticationService" />
        <property name="portalExecutablesPath" value="/opt/vidyo/bin/"/>
        <property name="transactionService" ref="transactionService" />
        <property name="roomService" ref="roomService" />
		<property name="uploadTempDirSuper" value="${upload.temp.dir.super}"/>
    </bean>


	<!-- Tenant service -->
	<bean id="tenantDao" class="com.vidyo.db.TenantDaoJdbcImpl">
		<property name="jdbcTemplate" ref="jdbcTemplate"/>
		<property name="namedParamJdbcTemplate" ref="namedParamJdbcTemplate"/>
	</bean>

	<bean id="tenantConfigurationDao" class="com.vidyo.db.TenantConfigurationDaoJdbcImpl">
		<property name="jdbcTemplate" ref="jdbcTemplate"/>
	</bean>

	<bean id="tenantService" class="com.vidyo.service.TenantServiceImpl">
		<property name="dao" ref="tenantDao"/>
		<property name="systemDao" ref="systemDao"/>
		<property name="license" ref="licensingService"/>
		<property name="ipcConfigurationService" ref="ipcConfigurationService"/>
		<property name="roomService" ref="roomService"/>
		<property name="tenantLdapAttributesMappingDao" ref="tenantLdapAttributesDao" />
		<property name="tenantIdpAttributesMappingDao" ref="tenantIdpAttributesDao" />
		<property name="systemService" ref="systemService" />
		<property name="serviceService" ref="serviceService" />
		<property name="memberService" ref="memberService"/>
		<property name="groupDao" ref="groupDao"/>
		<property name="roomDao" ref="roomDao"/>
		<property name="endpointUploadDao" ref="endpointUploadDao"/>
		<property name="tenantConfigurationDao" ref="tenantConfigurationDao" />
		<property name="memberService2" ref="memberService1" />
		<property name="ignoreTenantUrls">
            <list>
                <value>127.0.0.1</value>
                <value>::1</value>
                <value>localhost</value>
            </list>
		</property>
		<property name="conferenceService" ref="conferenceService" />
		<property name="transactionService" ref="transactionService" />
	</bean>

	<!--  Portal Web Services -->
	<bean id="portalWSController" class="org.springframework.web.servlet.mvc.ServletWrappingController">
		<property name="servletName" value="super-services"/>
		<property name="servletClass" value="org.apache.axis2.transport.http.AxisServlet"/>
	</bean>

    <!--  Portal Super Service -->
	<bean id="vidyoPortalSuperServiceEndPoint" class="com.vidyo.portal.superapi.VidyoPortalSuperServiceSkeleton">
		<property name="license" ref="licensingService"/>
		<property name="tenantService" ref="tenantService"/>
		<property name="serviceService" ref="serviceService"/>
		<property name="systemService" ref="systemService"/>
		<property name="ipcDomainService" ref="ipcDomainService"/>
		<property name="memberService" ref="memberService"/>
		<property name="securityService" ref="securityService"/>
		<property name="userService" ref="userService"/>
		<property name="uploadTempDirSuper" value="${upload.temp.dir.super}"/>
	</bean>

	<bean id="securityService" class="com.vidyo.service.SecurityServiceImpl">
		<property name="messages" ref="messageSource"/>
		<property name="tmpDirectory" value="${upload.temp.dir.super}"/>
	</bean>

 <bean id="statusService" class="com.vidyo.service.status.VidyoPortalStatusServiceImpl">
  <property name="uploadTempDirSuper" value="${upload.temp.dir.super}"/>
 </bean>
	<bean id="cdrDao" class="com.vidyo.db.CDRCollectionDaoJdbcImpl">
		<property name="jdbcTemplate" ref="jdbcTemplate"/>
	</bean>

	<bean id="cdr2Dao" class="com.vidyo.db.CDRCollection2DaoJdbcImpl">
		<property name="jdbcTemplate" ref="jdbcTemplate"/>
	</bean>

	<bean id="cloudJaxb2Marshaller" class="org.springframework.oxm.jaxb.Jaxb2Marshaller">
		<property name="classesToBeBound">
			<list>
				<value>com.vidyo.parser.xml.cloudconfig.AndType</value>
				<value>com.vidyo.parser.xml.cloudconfig.BandwidthMapType</value>
				<value>com.vidyo.parser.xml.cloudconfig.BasicAndType</value>
				<value>com.vidyo.parser.xml.cloudconfig.BasicNotType</value>
				<value>com.vidyo.parser.xml.cloudconfig.BasicOrType</value>
				<value>com.vidyo.parser.xml.cloudconfig.BasicRuleSet</value>
				<value>com.vidyo.parser.xml.cloudconfig.BasicRuleType</value>
				<value>com.vidyo.parser.xml.cloudconfig.Candidates</value>
				<value>com.vidyo.parser.xml.cloudconfig.CategoriesType</value>
				<value>com.vidyo.parser.xml.cloudconfig.EqualToType</value>
				<value>com.vidyo.parser.xml.cloudconfig.GreaterThanOrEqualToType</value>
				<value>com.vidyo.parser.xml.cloudconfig.GreaterThanType</value>
				<value>com.vidyo.parser.xml.cloudconfig.GroupType</value>
				<value>com.vidyo.parser.xml.cloudconfig.IPV4AddressRangeType</value>
				<value>com.vidyo.parser.xml.cloudconfig.IPV4SubnetType</value>
				<value>com.vidyo.parser.xml.cloudconfig.LessThanOrEqualToType</value>
				<value>com.vidyo.parser.xml.cloudconfig.LessThanType</value>
				<value>com.vidyo.parser.xml.cloudconfig.ListMemberType</value>
				<value>com.vidyo.parser.xml.cloudconfig.LocationType</value>
				<value>com.vidyo.parser.xml.cloudconfig.NetworkConfigType</value>
				<value>com.vidyo.parser.xml.cloudconfig.NetworkElement</value>
				<value>com.vidyo.parser.xml.cloudconfig.NotType</value>
				<value>com.vidyo.parser.xml.cloudconfig.OrType</value>
				<value>com.vidyo.parser.xml.cloudconfig.RuleSetType</value>
				<value>com.vidyo.parser.xml.cloudconfig.ObjectFactory</value>
			</list>
		</property>
		<property name="marshallerProperties">
	        <map>
	            <entry key="jaxb.formatted.output">
	                <value type="boolean">true</value>
	            </entry>
	        </map>
   		 </property>
		<property name="schema"
			value="classpath:com/vidyo/parser/xml/NetworkConfig.xsd" />
	</bean>

	<bean id="vmJaxb2Marshaller" class="org.springframework.oxm.jaxb.Jaxb2Marshaller">
		<property name="classesToBeBound">
			<list>
				<value>com.vidyo.parser.xml.vmconfig.VMConfigType</value>
				<value>com.vidyo.parser.xml.vmconfig.VpURI</value>
				<value>com.vidyo.parser.xml.vmconfig.ObjectFactory</value>
			</list>
		</property>
		<property name="marshallerProperties">
	        <map>
	            <entry key="jaxb.formatted.output">
	                <value type="boolean">true</value>
	            </entry>
	        </map>
   		 </property>
		<property name="schema" value="classpath:com/vidyo/parser/xml/vmconfig.xsd" />
	</bean>

	<bean id="vrJaxb2Marshaller" class="org.springframework.oxm.jaxb.Jaxb2Marshaller">
		<property name="classesToBeBound">
			<list>
				<value>com.vidyo.parser.xml.vrconfig.MediaStreamPrecedenceType</value>
				<value>com.vidyo.parser.xml.vrconfig.ObjectFactory</value>
				<value>com.vidyo.parser.xml.vrconfig.VMAccessType</value>
				<value>com.vidyo.parser.xml.vrconfig.VRConfigType</value>
				<value>com.vidyo.parser.xml.vrconfig.VrURI</value>
			</list>
		</property>
		<property name="marshallerProperties">
	        <map>
	            <entry key="jaxb.formatted.output">
	                <value type="boolean">true</value>
	            </entry>
	        </map>
   		 </property>
		<property name="schema" value="classpath:com/vidyo/parser/xml/vrconfig.xsd" />
	</bean>

	<bean id="memberService1" class="com.vidyo.service.member.MemberServiceImpl">
		<property name="memberDao" ref="memberDao"/>
		<property name="roomService" ref="roomService"/>
		<property name="licenseService" ref="licensingService"/>
		<property name="systemService" ref="systemService"/>
		<property name="emailService" ref="emailService"/>
		<property name="serviceService" ref="serviceService"/>
		<property name="groupService" ref="groupService"/>
		<property name="tenantService" ref="tenantService"/>
		<property name="ms" ref="messageSource"/>
		<property name="memberService" ref="memberService"/>
		<property name="userService" ref="userService" />
	</bean>

	<bean id="systemService1" class="com.vidyo.service.system.SystemServiceImpl">
		<property name="systemDao" ref="systemDao" />
		<property name="httpConnectionManager" ref="connectionManager" />
	</bean>

	<bean id="endpointService" class="com.vidyo.service.endpoints.EndpointServiceImpl">
		<property name="endpointDao" ref="endpointDao" />
	</bean>

	<bean id="endpointDao" class="com.vidyo.db.endpoints.EndpointDaoImpl">
		<property name="jdbcTemplate" ref="jdbcTemplate" />
	</bean>

	<bean id="cdrCollectionService" class="com.vidyo.service.cdrcollection.CdrCollectionServiceImpl">
		<property name="cdrCollectionVersion1Dao" ref="cdrDao" />
		<property name="cdrCollectionVersion2Dao" ref="cdr2Dao" />
		<property name="systemService" ref="systemService" />
        <property name="userService" ref="userService"/>
	</bean>

	<bean id="tokenGenerator" class="com.vidyo.framework.security.utils.TokenGeneratorImpl">
	</bean>

	<!-- LDAP Integration -->
	<bean id="ldapUserToMemberAttributesMapper" class="com.vidyo.service.ldap.LdapUserToMemberAttributesMapperImpl">
		<property name="system" ref="systemService"/>
		<property name="group" ref="groupService"/>
		<property name="member" ref="memberService"/>
		<property name="room" ref="roomService"/>
		<property name="tenantLdapAttributes" ref="tenantLdapAttributes"/>
		<property name="license" ref="licensingService"/>
		<property name="tenantService" ref="tenantService" />
	</bean>

	<bean id="tenantLdapAttributesDao" class="com.vidyo.db.ldap.TenantLdapAttributesMappingDaoJdbcImpl">
		<property name="jdbcTemplate" ref="jdbcTemplate"/>
	</bean>

	<bean id="tenantLdapAttributes" class="com.vidyo.service.ldap.TenantLdapAttributesMappingImpl">
		<property name="dao" ref="tenantLdapAttributesDao"/>
		<property name="memberDao" ref="memberDao"/>
		<property name="groupDao" ref="groupDao"/>
	</bean>

	<bean id="roomPropertiesGenerator" class="com.vidyo.utils.room.RoomExtnGenerator">
		<property name="tenantConfigurationDao" ref="tenantConfigurationDao" />
		<property name="roomDao" ref="roomDao" />
	</bean>

	<bean id="bindEndpointService" class="com.vidyo.service.bindendpoint.BindEndpointServiceImpl">
		<property name="userService" ref="userService"/>
		<property name="vidyoRoomRoleName" value="${vidyoroomrolename}"/>
		<property name="vidyoPanoramaRoleName" value="${vidyopanoramarolename}"/>
		<property name="memberService" ref="memberService1" />
		<property name="systemService" ref="systemService1" />
        <property name="system" ref="systemService"/>
        <property name="endpointService" ref="endpointService"/>
	</bean>

    <bean id="transactionService" class="com.vidyo.service.transaction.TransactionServiceImpl">
    	<property name="transactionDao" ref="transactionDao"></property>
    	<property name="tenantDao" ref="tenantDao"/>
    </bean>

    <bean id="transactionDao" class="com.vidyo.db.transaction.TransactionDaoJdbcImpl">
    	<property name="jdbcTemplate" ref="auditJdbcTemplate"></property>
    </bean>

    <bean id="auditDataSource" class="org.springframework.jndi.JndiObjectFactoryBean">
		<property name="jndiName" value="java:comp/env/jdbc/portal2audit" />
		<property name="resourceRef" value="true"/>
    </bean>

    <bean id="auditJdbcTemplate" class="org.springframework.jdbc.core.JdbcTemplate">
        <property name="dataSource" ref="auditDataSource"/>
    </bean>

	<bean id="appEventListener" class="com.vidyo.framework.listeners.ApplicationEventListener">
		<property name="tenantService" ref="tenantService" />
		<property name="transactionService" ref="transactionService" />
	</bean>

	<bean id="tokenRepository" class="com.vidyo.db.security.token.VidyoTokenRepositoryImpl">
		<property name="dataSource" ref="dataSource"/>
		<property name="createTableOnStartup" value="false"/>
	</bean>

	<bean id="persistentTokenService" class="com.vidyo.service.security.token.PersistentTokenServiceImpl">
		<property name="endpointService" ref="endpointService" />
		<property name="tokenGenerator" ref="tokenGenerator"/>
		<property name="persistentTokenRepository" ref="tokenRepository"/>
	</bean>

    <!-- Initialization of OpenSAML library-->
    <bean class="org.springframework.security.saml.SAMLBootstrap"/>

    <!-- XML parser pool needed for OpenSAML parsing -->
    <bean id="parserPool" class="org.opensaml.xml.parse.StaticBasicParserPool" scope="singleton" init-method="initialize"/>
    <bean id="parserPoolHolder" class="org.springframework.security.saml.parser.ParserPoolHolder" scope="singleton"/>

    <bean id="samlAuthenticationService" class="com.vidyo.service.authentication.saml.SamlAuthenticationServiceImpl">
        <property name="systemDao" ref="systemDao"/>
        <property name="tenantService" ref="tenantService"/>
        <property name="propertyPlaceholderConfigurer" ref="propertyConfigurer"/>
        <property name="parserPool" ref="parserPool"/>
        <property name="tenantIdpAttributesMappingDao" ref="tenantIdpAttributesDao"/>
        <property name="memberService1" ref="memberService1"/>
        <property name="systemService" ref="systemService"/>
    </bean>

    <!-- IDP Integration -->
	<bean id="idpUserToMemberAttributesMapper" class="com.vidyo.service.idp.IdpUserToMemberAttributesMapperImpl">
		<property name="groupService" ref="groupService"/>
		<property name="systemService" ref="systemService"/>
		<property name="serviceService" ref="serviceService"/>
		<property name="memberService" ref="memberService"/>
		<property name="tenantIdpAttributes" ref="tenantIdpAttributes"/>
		<property name="roomService" ref="roomService" />
	</bean>

	<bean id="tenantIdpAttributesDao" class="com.vidyo.db.idp.TenantIdpAttributesMappingDaoJdbcImpl">
		<property name="jdbcTemplate" ref="jdbcTemplate"/>
	</bean>

	<bean id="tenantIdpAttributes" class="com.vidyo.service.idp.TenantIdpAttributesMappingImpl">
		<property name="tenantIdpAttributesMappingDao" ref="tenantIdpAttributesDao"/>
		<property name="groupDao" ref="groupDao"/>
		<property name="memberDao" ref="memberDao"/>
	</bean>

    <!-- Member History-->
    <bean id="memberLoginHistoryService" class="com.vidyo.service.loginhistory.MemberLoginHistoryServiceImpl">
		<property name="memberLoginHistoryDao" ref="memberLoginHistoryDao"/>
	</bean>

    <bean id="memberLoginHistoryDao" class="com.vidyo.db.loginhistory.MemberLoginHistoryDaoJdbcImpl">
		<property name="dataSource" ref="dataSource"/>
	</bean>

    <bean id="memberPasswordHistoryService" class="com.vidyo.service.passwdhistory.MemberPasswordHistoryServiceImpl">
		<property name="memberService" ref="memberService"/>
		<property name="memberPasswordHistoryDAO" ref="memberPasswordHistoryDAO" />
	</bean>

	<bean id="memberPasswordHistoryDAO" class="com.vidyo.db.passwdhistory.MemberPasswordHistoryDAOJdbcImpl">
		<property name="dataSource" ref="dataSource"/>
    </bean>

	<bean id="userAuthDao" class="com.vidyo.db.authentication.UserAuthDaoJdbcImpl">
		<property name="dataSource" ref="dataSource"/>
		<property name="usersByUsernameQuery">
			<value>
				SELECT
				m.username as username,
				m.password as password,
				m.bak as bak,
				m.sak as sak,
				CASE
					WHEN m.active = 1 THEN 'true' ELSE 'false'
				END as enabled,
				CASE
					WHEN m.allowedToParticipate = 1 THEN 'true' ELSE 'false'
				END as allowedToParticipate,
				m.importedUsed as importedUser,
				m.tenantID as tenantID,
				m.memberID as memberID,
				m.langID as langId,
				m.memberName as memberName,
				m.emailAddress as emailAddress,
				m.pak2 as pak2,
				m.lastModifiedDateExternal as lastModifiedDateExternal
				FROM
				Member m
				WHERE
				m.username = ?
				AND
				m.tenantID = ?
			</value>
		</property>
		<property name="authoritiesByUsernameQuery">
			<value>
				SELECT
				m.username as username,
				CASE
					WHEN mr.roleName = 'Admin' THEN 'ROLE_ADMIN'
					WHEN mr.roleName = 'Operator' THEN 'ROLE_OPERATOR'
					WHEN mr.roleName = 'Normal' THEN 'ROLE_NORMAL'
					WHEN mr.roleName = '${vidyoroomrolename}' THEN 'ROLE_VIDYOROOM'
					WHEN mr.roleName = 'Super' THEN 'ROLE_SUPER'
					WHEN mr.roleName = 'Executive' THEN 'ROLE_EXECUTIVE'
					WHEN mr.roleName = 'VidyoPanorama' THEN 'ROLE_VIDYOPANORAMA'
				END as authority
				FROM
				Member m
				INNER JOIN MemberRole mr ON (mr.roleID=m.roleID)
				WHERE
				m.username = ?
				AND
				m.tenantID = ?
			</value>
		</property>
	</bean>

	<bean id="userDesktopAuthDao" class="com.vidyo.db.authentication.UserDesktopAuthDaoJdbcImpl">
		<property name="dataSource" ref="dataSource"/>
		<property name="usersByUsernameQuery">
			<value>
				SELECT
				m.username as username,
				m.sak as password,
				m.bak as bak,
				m.sak as sak,
				CASE
					WHEN m.active = 1 THEN 'true' ELSE 'false'
				END as enabled,
				CASE
					WHEN m.allowedToParticipate = 1 THEN 'true' ELSE 'false'
				END as allowedToParticipate,
				m.importedUsed as importedUser,
				m.tenantID as tenantID,
				m.memberID as memberID,
				m.langID as langId,
				m.memberName as memberName,
				m.emailAddress as emailAddress
				FROM
				Member m
				WHERE
				m.username = ?
				AND
				m.tenantID = ?
			</value>
		</property>
		<property name="authoritiesByUsernameQuery">
			<value>
				SELECT
				m.username as username,
				CASE
					WHEN mr.roleName = 'Admin' THEN 'ROLE_ADMIN'
					WHEN mr.roleName = 'Operator' THEN 'ROLE_OPERATOR'
					WHEN mr.roleName = 'Normal' THEN 'ROLE_NORMAL'
					WHEN mr.roleName = '${vidyoroomrolename}' THEN 'ROLE_VIDYOROOM'
					WHEN mr.roleName = 'Super' THEN 'ROLE_SUPER'
					WHEN mr.roleName = 'Executive' THEN 'ROLE_EXECUTIVE'
					WHEN mr.roleName = 'VidyoPanorama' THEN 'ROLE_VIDYOPANORAMA'
				END as authority
				FROM
				Member m
				INNER JOIN MemberRole mr ON (mr.roleID=m.roleID)
				WHERE
				m.username = ?
				AND
				m.tenantID = ?
			</value>
		</property>
	</bean>

	<bean id="licenseDao" class="com.vidyo.db.license.LicenseDaoSudoImpl">
		<property name="licenseScript" value="/opt/vidyo/app/VPLicenseMgr/bin/VPLicenseMgr" />
		<property name="licenseTextFilePath" value="/opt/vidyo/portal2/license/license.txt" />
	</bean>

    <bean id="gatewayService" class="com.vidyo.service.gateway.GatewayServiceImpl">
        <property name="servicesService" ref="serviceService"/>
        <property name="conferenceAppService" ref="conferenceAppService"/>
        <property name="conferenceService" ref="conferenceService"/>
        <property name="endpointService" ref="endpointService"/>
        <property name="memberService" ref="memberService"/>
        <property name="roomService" ref="roomService"/>
        <property name="tenantService" ref="tenantService"/>
    </bean>

    <bean id="lectureModeDao" class="com.vidyo.db.lecturemode.LectureModeDaoImpl">
        <property name="dataSource" ref="dataSource"/>
    </bean>

	<bean id="entityManagerFactory"
		class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean">
		<property name="dataSource" ref="dataSource" />
		<property name="jpaDialect">
			<bean class="org.springframework.orm.jpa.vendor.HibernateJpaDialect"/>
		</property>
		<property name="jpaVendorAdapter" ref="jpaVendorAdapter"/>
		<property name="persistenceXmlLocation" value="classpath:persistence.xml"/>

	</bean>

	<bean id="jpaVendorAdapter" class="org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter">
        <property name="showSql" value="false"/>
        <property name="generateDdl" value="false"/>
        <property name="database" value="MYSQL"/>
    </bean>

	<bean id="transactionManager" class="org.springframework.orm.jpa.JpaTransactionManager">
		<property name="entityManagerFactory" ref="entityManagerFactory"/>
		<property name="dataSource" ref="dataSource"/>
	</bean>

	<bean id="networkJaxb2Marshaller" class="org.springframework.oxm.jaxb.Jaxb2Marshaller">
		<property name="classesToBeBound">
			<list>
				<value>com.vidyo.parser.xsd.networkconfig.AndType</value>
				<value>com.vidyo.parser.xsd.networkconfig.BandwidthMapElementType</value>
				<value>com.vidyo.parser.xsd.networkconfig.BandwidthMapType</value>
				<value>com.vidyo.parser.xsd.networkconfig.BasicAndType</value>
				<value>com.vidyo.parser.xsd.networkconfig.BasicNotType</value>
				<value>com.vidyo.parser.xsd.networkconfig.BasicOrType</value>
				<value>com.vidyo.parser.xsd.networkconfig.BasicRuleSet</value>
				<value>com.vidyo.parser.xsd.networkconfig.BasicRuleType</value>
				<value>com.vidyo.parser.xsd.networkconfig.Candidates</value>
				<value>com.vidyo.parser.xsd.networkconfig.CategoriesType</value>
				<value>com.vidyo.parser.xsd.networkconfig.EqualToType</value>
				<value>com.vidyo.parser.xsd.networkconfig.GreaterThanOrEqualToType</value>
				<value>com.vidyo.parser.xsd.networkconfig.GreaterThanType</value>
				<value>com.vidyo.parser.xsd.networkconfig.GroupListType</value>
				<value>com.vidyo.parser.xsd.networkconfig.GroupType</value>
				<value>com.vidyo.parser.xsd.networkconfig.IPV4AddressRangeType</value>
				<value>com.vidyo.parser.xsd.networkconfig.IPV4SubnetType</value>
				<value>com.vidyo.parser.xsd.networkconfig.LessThanOrEqualToType</value>
				<value>com.vidyo.parser.xsd.networkconfig.LessThanType</value>
				<value>com.vidyo.parser.xsd.networkconfig.ListMemberType</value>
				<value>com.vidyo.parser.xsd.networkconfig.LocationType</value>
				<value>com.vidyo.parser.xsd.networkconfig.NetworkConfigType</value>
				<value>com.vidyo.parser.xsd.networkconfig.NetworkElement</value>
				<value>com.vidyo.parser.xsd.networkconfig.NetworkElementsType</value>
				<value>com.vidyo.parser.xsd.networkconfig.NotType</value>
				<value>com.vidyo.parser.xsd.networkconfig.OrType</value>
				<value>com.vidyo.parser.xsd.networkconfig.RuleSetType</value>
				<value>com.vidyo.parser.xsd.networkconfig.PrioritizedGroupListsType</value>
				<value>com.vidyo.parser.xsd.networkconfig.SCIPListenAddressType</value>
				<value>com.vidyo.parser.xsd.networkconfig.ObjectFactory</value>
			</list>
		</property>
		<property name="marshallerProperties">
	        <map>
	            <entry key="jaxb.formatted.output">
	                <value type="boolean">true</value>
	            </entry>
	        </map>
   		 </property>
		<property name="schema"
			value="classpath:com/vidyo/parser/xsd/NetConfigParser.xsd" />
	</bean>

	<bean id="managerJaxb2Marshaller" class="org.springframework.oxm.jaxb.Jaxb2Marshaller">
		<property name="classesToBeBound">
			<list>
				<value>com.vidyo.parser.xsd.vmconfig.DatabaseConfigType</value>
				<value>com.vidyo.parser.xsd.vmconfig.EMCPListenAddressType</value>
				<value>com.vidyo.parser.xsd.vmconfig.RMCPListenAddressType</value>
				<value>com.vidyo.parser.xsd.vmconfig.SOAPListenAddressType</value>
				<value>com.vidyo.parser.xsd.vmconfig.VidyoPortalConnectAddressType</value>
				<value>com.vidyo.parser.xsd.vmconfig.VMConfigType</value>
				<value>com.vidyo.parser.xsd.vmconfig.VpURI</value>
				<value>com.vidyo.parser.xsd.vmconfig.ObjectFactory</value>
			</list>
		</property>
		<property name="marshallerProperties">
	        <map>
	            <entry key="jaxb.formatted.output">
	                <value type="boolean">true</value>
	            </entry>
	        </map>
   		 </property>
		<property name="schema" value="classpath:com/vidyo/parser/xsd/VMConfigParser.xsd" />
	</bean>

	<bean id="routerJaxb2Marshaller" class="org.springframework.oxm.jaxb.Jaxb2Marshaller">
		<property name="classesToBeBound">
			<list>
				<value>com.vidyo.parser.xsd.vr2config.CMCPAddressListType</value>
				<value>com.vidyo.parser.xsd.vr2config.ConnectVMListType</value>
				<value>com.vidyo.parser.xsd.vr2config.ListenVMListType</value>
				<value>com.vidyo.parser.xsd.vr2config.MediaAddressMapType</value>
				<value>com.vidyo.parser.xsd.vr2config.MediaPortRangeType</value>
				<value>com.vidyo.parser.xsd.vr2config.MediaStreamPrecedenceType</value>
				<value>com.vidyo.parser.xsd.vr2config.ObjectFactory</value>
				<value>com.vidyo.parser.xsd.vr2config.VMAccessType</value>
				<value>com.vidyo.parser.xsd.vr2config.VRConfigType</value>
				<value>com.vidyo.parser.xsd.vr2config.VrURI</value>
			</list>
		</property>
		<property name="marshallerProperties">
	        <map>
	            <entry key="jaxb.formatted.output">
	                <value type="boolean">true</value>
	            </entry>
	        </map>
   		 </property>
		<property name="schema" value="classpath:com/vidyo/parser/xsd/vr2configparser.xsd" />
	</bean>

	<bean id="cacheAdministrationService" class="com.vidyo.service.cache.CacheAdministrationServiceImpl">
		<property name="cacheManager" ref="superServiceCacheManager"/>
	</bean>

	<bean id="conferenceAppService" class="com.vidyo.service.conference.ConferenceAppServiceImpl">
		<property name="conferenceService" ref="conferenceService"/>
		<property name="federationConferenceService" ref="federationConferenceService"/>
		<property name="memberService" ref="memberService"/>
		<property name="roomService" ref="roomService"/>
		<property name="systemService" ref="systemService1"/>
		<property name="tenantService" ref="tenantService"/>
		<property name="userService" ref="userService"/>
	</bean>

</beans>